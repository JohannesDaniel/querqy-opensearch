apply plugin: 'java'
apply plugin: 'jacoco'
apply plugin: 'idea'
apply plugin: 'opensearch.opensearchplugin'

opensearchplugin {
    name 'querqy-opensearch'
    description 'Query rewriting plugin'
    classname 'querqy.opensearch.QuerqyPlugin'
    licenseFile rootProject.file('LICENSE.txt')
    noticeFile rootProject.file('NOTICE.txt')
}



buildscript {
    repositories {
        mavenCentral()
        jcenter()
        mavenLocal()
    }

    dependencies {
        classpath "org.opensearch.gradle:build-tools:1.0.0-beta1"
    }
}

repositories {
    mavenLocal()
}

// TODO: versions to variables
dependencies {
    implementation('org.querqy:querqy-lucene:5.1.lucene810.0') {
        exclude group: 'com.fasterxml.jackson.core', module: 'jackson-core'
    }
    // Why is it needed to explicitly include querqy-core??
    implementation('org.querqy:querqy-core:3.11.0')

    implementation('com.fasterxml.jackson.core:jackson-databind:2.9.9')
    implementation('com.jayway.jsonpath:json-path:2.4.0')
    // implementation('org.opensearch:opensearch:1.0.0-beta1')

    testImplementation('org.opensearch.test:framework:1.0.0-beta1')
    testImplementation('org.apache.logging.log4j:log4j-core:2.11.1')
    testImplementation('org.assertj:assertj-core:3.15.0')


}

jacoco {
    toolVersion = "0.8.5"
}

test {
    useJUnit()
    finalizedBy jacocoTestReport
    systemProperties 'java.security.policy': file("$projectDir/plugin-security.policy").absolutePath
}

jacocoTestReport {
    dependsOn test // tests are required to run before generating the report
}

// TODO: Cleanup code base to enable checks
forbiddenApisTest.enabled = false
checkstyleTest.enabled = false

dependencyLicenses.enabled = false
licenseHeaders.enabled = false
thirdPartyAudit.enabled = false

loggerUsageCheck.enabled = false
testingConventions.enabled = false
validateNebulaPom.enabled = false

